<!-- Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WB5KTHQ7"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->
<ui-toast></ui-toast>
<header class="bg-white shadow-md py-4 px-6 flex justify-between items-center fixed top-0 w-full z-50">
    <!-- Logo -->
    <div class="flex items-center space-x-2">
        <a href="#app-beta">
            <img src="/img/logo.png" alt="NutriLog logo" class="w-8 h-8">
        </a>
        <a href="/" class="text-2xl font-semibold text-gray-800">
            <span>NutriLog</span>
        </a>

    </div>


    <!-- Desktop Navigation -->
    <nav class="desktop-nav">
        <!-- a href="/app/playbook/start.html">Start Your Journey</a -->
    </nav>

    <!-- Authentication Buttons -->
    <div class="hidden md:flex space-x-4">
        {{^isAuthenticated}}
        <a href="/app/login" class="btn-gray">Login</a>
        <a href="/app/register" class="btn-green">Join Free</a>
        {{/isAuthenticated}}

        {{#isAuthenticated}}
        <div class="relative">
            <button id="user-menu-button" class="p-2 text-gray-600 hover:bg-gray-100 rounded-md">
                <i data-lucide="user"></i>
            </button>

            <!-- Dropdown Menu -->
            <div id="user-menu" class="hidden absolute right-0 mt-2 w-60 bg-white shadow-lg rounded-md py-2">
                <a href="/app/playbook/start.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    Start Your Journey</a>
                <a href="https://chatgpt.com/g/g-FaoraVhde-nutrilog" target="_blank"
                   class="gtm-gpt-link block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    AI Assistant
                </a>
                <a href="/app/dashboard" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Dashboard</a>
                <a href="/app/playbook/feedback.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    Send Feedback</a>
                <a href="/fl64-web-session/logout" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Logout</a>
            </div>
        </div>
        {{/isAuthenticated}}
    </div>

    <!-- Mobile Menu Button -->
    <button id="menu-button" class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-md">
        <i data-lucide="menu"></i>
    </button>
</header>

<!-- Mobile Menu -->
<div id="mobile-menu">
    <a href="/app/playbook/start.html" class="block text-gray-700 py-2">Start Your Journey</a>

    {{^isAuthenticated}}
    <a href="/app/login"
       class="block bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-center mt-4">Login</a>
    <a href="/app/register"
       class="block bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md text-center mt-2">Join Free</a>
    {{/isAuthenticated}}

    {{#isAuthenticated}}
    <div class="border-t border-gray-200 mt-4 pt-4">
        <a href="/app/playbook/feedback.html" class="block text-gray-700 py-2">Send Feedback</a>
        <a href="https://chatgpt.com/g/g-FaoraVhde-nutrilog" target="_blank"
           class="gtm-gpt-link block text-gray-700 py-2">
            AI Assistant
        </a>
        <a href="/app/dashboard" class="block text-gray-700 py-2">Dashboard</a>
        <a href="/fl64-web-session/logout" class="block text-gray-700 py-2">Logout</a>
    </div>
    {{/isAuthenticated}}
</div>

<script>
    // Mobile menu toggle
    const menuButton = document.getElementById('menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    menuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('active');
    });

    // User dropdown menu toggle
    const userMenuButton = document.getElementById('user-menu-button');
    const userMenu = document.getElementById('user-menu');
    if (userMenuButton) {
        userMenuButton.addEventListener('click', () => {
            userMenu.classList.toggle('hidden');
        });

        // Close menu when clicking outside
        document.addEventListener('click', (event) => {
            if (!userMenuButton.contains(event.target) && !userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });
    }
</script>
